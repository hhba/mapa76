-# coding: utf-8
- content_for :javascripts do
  = javascript_include_tag 'bootstrap-alert', 'documents'

%script#documentContextError{:type => "text/template"}
  .alert.alert-error
    Ocurrió un error al obtener información de contexto del documento.

%script#documentContext{:type => "text/template"}
  .document{data: {id: "{{id}}"}}
    %h4
      {{heading}}
    %ul.nav.nav-tabs  
      %li.active
        %a{href: '#facts', data:{toggle: 'tab'}} Hechos
      %li
        %a{href: '#names', data:{toggle: 'tab'}} Nombres
      %li
        %a{href: '#organizations', data:{toggle: 'tab'}} Organizaciones
      %li
        %a{href: '#dates', data:{toggle: 'tab'}} Fechas
      %li
        %a{href: '#places', data:{toggle: 'tab'}} Lugares
    .tab-content
      .tab-pane.active#facts
        %ul
          {{#registers}}
          %li
            %span.people
              {{who}}
            %span.dates
              {{when}}
            %span.others
              {{what}}
            %span.places
              {{where}}
            %span.people
              {{to_who}}
          {{/registers}}
      .tab-pane#names
        %table.table.table-bordered.table-condensed.tablesorter
          %thead
            %tr
              %th
              %th
                Personas
              %th
                Menciones
          %tbody
            {{#people}}
            %tr
              %td.blacklist
                %a{href: "/api/blacklist/{{id}}"}
                  %i.icon-remove
              %td
                {{name}}
              %td
                {{mentions}}
            {{/people}}
        %a{href: '#'} Lista completa
      .tab-pane#organizations
        %table.table.table-bordered.table-condensed.tablesorter
          %thead
            %tr
              %th
                Organizaciones
              %th
                Menciones
          %tbody
            {{#organizations}}
            %tr
              %td
                {{text}}
              %td
                {{mentions}}
            {{/organizations}}
        %a{href: '#'} Lista completa
      .tab-pane#dates
        %table.table.table-bordered.table-condensed.tablesorter
          %thead
            %tr
              %th
                Fechas
              %th
                Menciones
          %tbody
            {{#dates}}
            %tr
              %td
                {{text}}
              %td
                {{mentions}}
            {{/dates}}
      .tab-pane#places
        %table.table.table-bordered.table-condensed.tablesorter
          %thead
            %tr
              %th
                Lugares
              %th
                Menciones
          %tbody
            {{#places}}
            %tr
              %td
                {{text}}
              %td
                {{mentions}}
            {{/places}}

.content.span9
  .subnav.subnav-fixed
    %ul.nav.nav-pills
      %li.active
        %a{:href => url_for(:documents, :index)} Documentos
      %li
        %a{:href => url_for(:documents, :new)} Nuevo
      %li
        %a{:href => url_for(:documents, :mine)} Mis documentos

- content_for :free do
  .row-fluid
    .content.span7
      .row-fluid
        .alert.fade.in.alert-success#stillProcessing{:style => 'display:none;'}
          %a.close{:href => '#', 'data-dismiss' => 'alert'}×
          %strong
            Recuerde que el procesamiento de tareas puede tomar algunos minutos.
      .row-fluid
        %table{:class => 'table documents', :id => 'sorteable'}
          %thead
            %tr
              %th{:style => "width: 70px"}
              %th
                %a{:href => '#', "data-sort" => "name"}Título
              %th
                %a{:href => '#', "data-sort" => "name"}Tipo
              %th
                %a{:href => '#', "data-sort" => "date"}Fecha
              %th
                %a{:href => '#', "data-sort" => "status"}Estado
          %tbody
            - @docs.each do |doc|
              %tr{:"data-id" => doc.id}
                %td{:style => "width: 70px"}
                  = thumbnail_tag doc
                %td
                  .title= doc.heading
                  .tools
                    .btn-group
                      %a.btn{:href => url_for(:documents, :comb, :id => doc._id), :class => (doc.readable? ? nil : "disabled")}
                        %i.icon-edit{:title => "Editar"}
                      %a.btn{:href => url_for(:documents, :map, :id => doc._id), :class => (doc.has_geocoded_addresses? ? nil : "disabled")}
                        %i.icon-globe{:title => "Mapa"}
                      %a.btn{:href => original_file_url(doc)}
                        %i.icon-download-alt{:title => "Descargar"}
                %td
                  = doc.category
                %td
                  = doc._id.generation_time.strftime("%d/%m/%y")
                %td.state
                  - if doc.processed?
                    Finalizado
                    .hidden{:style => "display: none;"}
                      .progress.progress-striped.active
                        .bar{:style => "width: 100%;"}
                  - else
                    .progress.progress-striped.active
                      .bar{:style => "width: #{doc.state_to_percentage}%;"}
    .content.span5#document
      %h4
        Haga clic en un documento para ver más información
