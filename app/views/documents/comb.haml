-# coding: utf-8
- content_for :styles do
  :css
    body {
     padding-top: 40px;
     background-color: #eee;
    }

- content_for :javascripts do
  = javascript_include_tag "http://maps.google.com/maps/api/js?sensor=true"
  = javascript_include_tag "js/maps.js"
  = javascript_include_tag "js/analize.js"
  :javascript
    AnalyzeApp.pageList.reset(#{@pages.to_json(:methods => :named_entities)});
    $(function() {
      $(".sidebar").mCustomScrollbar({
        mouseWheel: 5,
        scrollInertia: 250,
        advanced: {
          updateOnBrowserResize: true
        }
      });
    });

/ Document fontspec CSS classes
- @doc.fontspecs.each do |id, fs|
  :css
    .page p.fs#{id} {
      font-family: #{fs["family"]};
      font-size: #{fs["size"]}px;
      color: #{fs["color"]};
    }

/ Document content
.row-fluid
  .timeline-container
    #timeline{:data => {:dates => @doc.time_setter.to_json}}
  .timeline-button
    %button.btn.btn-mini.showTimeline{:type => "button"}= I18n.t("comb.show_timeline")
  .document
    %h2{:id => "document-heading", "data-document-id" => @doc.id}
      = @doc.heading
    .pages
      - @empty_pages.each do |page|
        .page.empty{:id => page.num, :"data-id" => page.id, :style => "width: 100%; height: #{page.height}px"}

-#
  .row-fluid
    .pages
    - if @paragraphs.length > 1
      .next_page
        = link_to I18n.t("comb.load_content"), url_for(:documents, :comb,
          :id => "next_page",
          :"data-next" => params[:page].to_i + 2,
          :"data-document" => @doc.id
      #loading{:style => "display:none; text-align: center;"}
        = image_tag 'images/ajax-bar-loader.gif', :style => "margin:0 auto;"

- content_for :sidebar do
  %ul.nav.nav-list#sidebar
    .alert.alert-error#register-error{style: "display:none;"}
      %a.close{href: '#', data: {dismiss: "alert"}}
      %strong= I18n.t("comb.alert_fail")
    .alert.alert-success#register-save{style: "display:none;"}
      %a.close{href: '#', data: {dismiss: "alert"}}
      %strong= I18n.t("comb.alert_success")
    %li.nav-header
      = I18n.t("comb.references")
    %ul#reference
      %li.people
        %input{:type => "checkbox", :id => :people_ref, :checked => true}
        %label{:for => :people_ref}= I18n.t("comb.persons")
      %li.organizations
        %input{:type => "checkbox", :id => :organizations_ref, :checked => true}
        %label{:for => :organizations_ref}= I18n.t("comb.organizations")
      %li.places
        %input{:type => "checkbox", :id => :places_ref, :checked => true}
        %label{:for => :places_ref}= I18n.t("comb.places")
      %li.dates
        %input{:type => "checkbox", :id => :dates_ref, :checked => true}
        %label{:for => :dates_ref}= I18n.t("comb.dates")
      %li.actions
        %input{:type => "checkbox", :id => :actions_ref, :checked => true}
        %label{:for => :actions_ref}= I18n.t("comb.actions")
    %li.nav-header#register
      = I18n.t("comb.facts")
      .new_register
        .who.box{"data-type" => "people", 'data-klass' => 'who'}
          %h3= I18n.t("comb.whos")
          .new
        .what.box{"data-type" => "what", 'data-klass' => 'what'}
          %h3= I18n.t("comb.what")
          .controls
            %input{:type => "text", :data => {:provide => "typeahead", :source => ActionEntity::VERBS.inspect}, :id => "whatSelector"}
        .when.box{"data-type" => "dates", 'data-klass' => 'when'}
          %h3= I18n.t("comb.when")
          .new
        .where.box{"data-type" => "places", 'data-klass' => 'where'}
          %h3= I18n.t("comb.where")
          .new
        .to_who.box{"data-type" => "people", 'data-klass' => 'to_who'}
          %h3= I18n.t("comb.to_who")
          .new
        .buttons
          %button{:class => 'btn btn-primary save'}
            = I18n.t("comb.save")
          %button{:class => 'btn btn-danger clean'}
            = I18n.t("comb.clean")

    %li.nav-header
      - if @center
        %a{:href => "/documents/#{@doc.id}/map", :target => "_blank"}= I18n.t("comb.map")
        .map#map{:data => {:addresses => @addresses.to_json(:methods => [:context, :page_num]), :center => @center.to_json}}
    %li.nav-header= I18n.t("comb.context")
    .context#context

/ Templates
%script#preRegisterTemplate{:type => "text/template"}
  .register{:class => "{{type}} {{ne_class}}", "data-ne-id" => "{{id}}"}
    {{text}}
    %button.close
      Ã—

%script#documentContextTemplate{:type => "text/template"}
  .breadcrumb
    %a{:href => "/documents/{{id}}", target: "_blank"}
      {{heading}}
  %dl.information
    %dt CategorÃ­a
    %dd {{category}}
  = partial "documents/context_tabs", :locals => { :small => true }

%script#personContext{:type => "text/template"}
  .breadcrumb
    %a{:href => "/documents/#{@doc.id}"}
      = @doc.heading
    >
    %a{:href => "/person/{{id}}"}
      {{name}}
  .information
    .field
      = I18n.t("comb.name") + ": {{full_name}}"
    .field
      = I18n.t("comb.tags") + ":"
      {{#tags}}
      %a{:href => "{{tag_link}}"}
        {{.}}
      {{/tags}}
    .field
      = I18n.t("comb.documents") + ":"
      {{#documents}}
      %a{:href => "/documents/{{id}}"}
        {{name}}
      {{/documents}}

%script#nextPageTemplate{:type => "text/template"}
  %a{:href => "{{url}}", :id => "next_page", "data-next" => "{{next_page}}", "data-document" => "{{id}}" }
    = I18n.t("comb.load_content")

%script#pageTemplate{:type => "text/template"}
  .page-content{:style => "display: none"}
    {{#textLines}}
    %p{:"data-id" => "{{_id}}", :class => "fs{{fontspec_id}}", :style => "top: {{top}}px; left: {{left}}px; width: {{width}}px"} {{{htmlText}}}
    {{/textLines}}

%script#textLineTemplate{:type => "text/template"}
  %p{:"data-id" => "{{_id}}", :class => "fs{{fontspec_id}}", :style => "top: {{top}}px; left: {{left}}px; width: {{width}}px"} {{{text}}}

%script#namedEntityTemplate{:type => "text/template"}
  %span.ne{:class => "ne {{ne_class}}", "data-ne-id" => "{{_id}}", "data-class" => "{{ne_class}}", "data-type" => "{{tag}}", "data-person-id" => "{{person_id}}", "data-lemma" => "{{lemma}}"} {{{originalText}}}
%script#mapTooltipTemplate{:type => "text/template"}
  %h3 {{ title }}
  %p
    %i> [...]
    {{{ context }}}
    %i [...]
  %p
    = I18n.t("comb.mentioned_in")
    %a{:href => "/documents/{{ document_id }}/comb\#{{ page_num }}"}= I18n.t("comb.page") + "{{ page_num }}"
